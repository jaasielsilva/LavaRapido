<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::div})}">
<body>
    <div>
        <header>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 th:text="${agendamento.id == null ? 'Novo Agendamento' : 'Editar Agendamento'}">Agendamento</h1>
                    <div class="subtitle">Informe os dados do serviço</div>
                </div>
            </div>
        </header>

        <form th:action="@{/agendamentos/salvar}" th:object="${agendamento}" method="post" class="card p-4 shadow-sm" style="background-color: #0f1623; border: 1px solid #1e293b;">
            <input type="hidden" th:field="*{id}" />
            <input type="hidden" th:field="*{status}" th:if="${agendamento.id == null}" /> <!-- Default status for new -->
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="veiculo" class="form-label text-light">Veículo</label>
                    <select class="form-select bg-dark text-light border-secondary" id="veiculo" th:field="*{veiculo}" required>
                        <option value="">Selecione um veículo...</option>
                        <option th:each="v : ${veiculos}" 
                                th:value="${v.id}" 
                                th:text="${v.modelo + ' - ' + v.placa + ' (' + v.cliente.nome + ')'}">
                            Civic - ABC-1234 (João)
                        </option>
                    </select>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="data" class="form-label text-light">Data e Hora</label>
                    <input type="datetime-local" class="form-control bg-dark text-light border-secondary" id="data" th:field="*{data}" required>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="servicoId" class="form-label text-light">Serviço</label>
                    <select class="form-select bg-dark text-light border-secondary" id="servicoId" name="servicoId">
                        <option value="">Selecione um serviço...</option>
                        <option th:each="s : ${catalogoServicos}"
                                th:value="${s.id}"
                                th:text="${s.nome}"
                                th:data-preco="${s.preco}">
                            Lavagem Completa
                        </option>
                    </select>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="servicos" class="form-label text-light">Serviços (descrição)</label>
                    <input type="text" class="form-control bg-dark text-light border-secondary" id="servicos" th:field="*{servicos}" placeholder="Ex: Lavagem Completa, Polimento...">
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="valor" class="form-label text-light">Valor Total (R$)</label>
                    <input type="number" step="0.01" class="form-control bg-dark text-light border-secondary" id="valor" th:field="*{valor}" placeholder="0.00">
                </div>
                
                <div class="col-md-4 mb-3" th:if="${agendamento.id != null}">
                    <label for="statusSelect" class="form-label text-light">Status</label>
                    <select class="form-select bg-dark text-light border-secondary" id="statusSelect" th:field="*{status}">
                        <option th:each="s : ${T(br.com.lavajato.model.agendamento.StatusAgendamento).values()}"
                                th:value="${s}" th:text="${s.descricao}">Agendado</option>
                    </select>
                </div>
            </div>

            <div class="mb-3">
                <label for="observacoes" class="form-label text-light">Observações</label>
                <textarea class="form-control bg-dark text-light border-secondary" id="observacoes" th:field="*{observacoes}" rows="3"></textarea>
            </div>

            <div class="d-flex gap-2 justify-content-end mt-4">
                <a th:href="@{/agendamentos}" class="btn btn-secondary">Cancelar</a>
                <button type="submit" class="btn btn-primary">
                    <i class="fa-solid fa-save"></i> Salvar
                </button>
            </div>
        </form>
        
        <script th:inline="javascript">
        /*<![CDATA[*/
            document.addEventListener('DOMContentLoaded', function () {
                var servicoSelect = document.getElementById('servicoId');
                var servicosInput = document.getElementById('servicos');
                var valorInput = document.getElementById('valor');

                if (servicoSelect) {
                    servicoSelect.addEventListener('change', function () {
                        var option = this.options[this.selectedIndex];
                        var nome = option.text || '';
                        var preco = option.getAttribute('data-preco');

                        if (nome && servicosInput && !servicosInput.value) {
                            servicosInput.value = nome;
                        }

                        if (preco && valorInput) {
                            valorInput.value = preco.replace(',', '.');
                        }
                    });
                }
            });
        /*]]>*/
        </script>
    </div>
</body>
</html>
