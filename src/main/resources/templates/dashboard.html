<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::div})}">
<body>
    <div>
        <!-- =================================================================================== -->
        <!-- DASHBOARD GLOBAL (Exclusivo MASTER)                                                 -->
        <!-- =================================================================================== -->
        <div th:if="${showGlobalDashboard}">
            <header>
                <h1>Painel Master</h1>
                <div class="subtitle">Visão Global do SaaS</div>
            </header>

            <div class="cards">
                <div class="card blue">
                    <div class="card-info">
                        <h4>Empresas Ativas</h4>
                        <span class="number" th:text="${empresasAtivas}">0</span>
                    </div>
                    <div class="icon-box">
                        <i class="fa-solid fa-building"></i>
                    </div>
                </div>

                <div class="card dark">
                    <div class="card-info">
                        <h4>Total de Veículos</h4>
                        <span class="number" th:text="${totalVeiculos}">0</span>
                    </div>
                    <div class="icon-box">
                        <i class="fa-solid fa-car"></i>
                    </div>
                </div>

                <div class="card green">
                    <div class="card-info">
                        <h4>Usuários Online</h4>
                        <span class="number" th:text="${usuariosOnline}">0</span>
                    </div>
                    <div class="icon-box">
                        <i class="fa-solid fa-signal"></i>
                    </div>
                </div>
            </div>

            <div class="grid-content">
                <div class="box full-width">
                    <div class="box-header">
                        <h3>Empresas Cadastradas</h3>
                        <i class="fa-solid fa-building"></i>
                    </div>
                    <div class="list">
                        <div class="item" th:each="emp : ${empresas}">
                            <div class="item-info">
                                <strong th:text="${emp.nome}">Nome Empresa</strong>
                                <div class="sub-info" th:text="${emp.cnpj}">CNPJ</div>
                            </div>
                            <div class="item-actions">
                                <span class="badge" th:classappend="${emp.ativo} ? 'bg-success' : 'bg-danger'"
                                      th:text="${emp.ativo ? 'Ativo' : 'Inativo'}">Status</span>
                                <a th:href="@{/dashboard(empresaId=${emp.id})}" class="btn btn-sm btn-outline-primary" title="Acessar Painel">
                                    <i class="fa-solid fa-arrow-right-to-bracket"></i> Painel
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- =================================================================================== -->
        <!-- DASHBOARD OPERACIONAL (CLIENTE / TENANT / IMPERSONATE)                              -->
        <!-- =================================================================================== -->
        <div th:unless="${showGlobalDashboard}">
            <header>
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1>Dashboard</h1>
                        <div class="subtitle">
                            Visão geral do seu negócio 
                            <span th:if="${isMaster}" th:text="'(' + ${empresaContexto.nome} + ')'" class="badge bg-warning text-dark"></span>
                        </div>
                    </div>
                    <div th:if="${isMaster}">
                        <a th:href="@{/dashboard}" class="btn btn-outline-secondary btn-sm">
                            <i class="fa-solid fa-arrow-left"></i> Voltar para Global
                        </a>
                    </div>
                </div>
            </header>

            <div class="cards">
                <div class="card blue">
                    <div class="card-info">
                        <h4>Clientes Cadastrados</h4>
                        <span class="number" th:text="${clientesCadastrados}">3</span>
                    </div>
                    <div class="icon-box">
                        <i class="fa-solid fa-users"></i>
                    </div>
                </div>

                <div class="card orange">
                    <div class="card-info">
                        <h4>Agendamentos Pendentes</h4>
                        <span class="number">2</span> <!-- Hardcoded for now -->
                    </div>
                    <div class="icon-box">
                        <i class="fa-solid fa-calendar-days"></i>
                    </div>
                </div>

                <div class="card dark">
                    <div class="card-info">
                        <h4>Serviços Hoje</h4>
                        <span class="number">2</span> <!-- Hardcoded for now -->
                    </div>
                    <div class="icon-box">
                        <i class="fa-solid fa-car"></i>
                    </div>
                </div>

                <div class="card green" sec:authorize="hasAnyRole('MASTER','ADMIN')">
                    <div class="card-info">
                        <h4>Faturamento Hoje</h4>
                        <span class="number">R$ 110</span> <!-- Hardcoded for now -->
                        <div class="stat">
                            <span class="up">↑ 12%</span> <span class="muted">vs. ontem</span>
                        </div>
                    </div>
                    <div class="icon-box">
                        <i class="fa-solid fa-dollar-sign"></i>
                    </div>
                </div>
            </div>

            <div class="grid-content">
                <!-- SERVIÇOS DE HOJE -->
                <div class="box">
                    <div class="box-header">
                        <h3>Serviços de Hoje</h3>
                        <i class="fa-regular fa-clock"></i>
                    </div>

                    <div class="list">
                        <div class="item">
                            <div class="item-info">
                                <strong>João Oliveira</strong>
                                <div class="sub-info">Volkswagen Golf - JKL-3456</div>
                                <div class="service-type">Lavagem Simples</div>
                            </div>
                            <div class="item-actions">
                                <span class="badge blue">Em Andamento</span>
                                <span class="price">R$ 40</span>
                            </div>
                        </div>

                        <div class="item">
                            <div class="item-info">
                                <strong>Cliente Avulso</strong>
                                <div class="sub-info">Fiat Argo - XYZ-9999</div>
                                <div class="service-type">Lavagem Completa</div>
                            </div>
                            <div class="item-actions">
                                <span class="badge green">Concluído</span>
                                <span class="price">R$ 70</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PRÓXIMOS AGENDAMENTOS -->
                <div class="box">
                    <div class="box-header">
                        <h3>Próximos Agendamentos</h3>
                        <i class="fa-regular fa-circle-check"></i>
                    </div>

                    <div class="list">
                        <div class="item">
                            <div class="item-info">
                                <strong>Carlos Silva</strong>
                                <div class="sub-info">Honda Civic - ABC-1234</div>
                                <div class="service-type">Lavagem Completa, Cristalização</div>
                            </div>
                            <div class="item-actions">
                                <div class="date-info">
                                    <span>19/01/2026</span>
                                    <span>14:21</span>
                                </div>
                                <span class="price">R$ 350</span>
                            </div>
                        </div>

                        <div class="item">
                            <div class="item-info">
                                <strong>Maria Santos</strong>
                                <div class="sub-info">BMW X1 - GHI-9012</div>
                                <div class="service-type">Polimento Técnico</div>
                            </div>
                            <div class="item-actions">
                                <div class="date-info">
                                    <span>20/01/2026</span>
                                    <span>14:21</span>
                                </div>
                                <span class="price">R$ 350</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
