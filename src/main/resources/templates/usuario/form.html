<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::div})}">
<body>
    <div>
        <header>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 th:text="${usuario.id == null ? 'Novo Usuário' : 'Editar Usuário'}">Usuário</h1>
                    <div class="subtitle">Defina os acessos e permissões da sua equipe</div>
                </div>
            </div>
        </header>

        <form th:action="@{/usuarios/salvar}" th:object="${usuario}" method="post"
              class="card p-4 shadow-sm"
              style="background-color: #0f1623; border: 1px solid #1e293b;">
            <input type="hidden" th:field="*{id}" />
            
            <div class="row">
                <div class="col-md-6 mb-3" th:if="${empresas != null}">
                    <label for="empresa" class="form-label text-light">Empresa</label>
                    <select class="form-select bg-dark text-light border-secondary" id="empresa" th:field="*{empresa}">
                        <option th:each="emp : ${empresas}" th:value="${emp.id}" th:text="${emp.nome}"></option>
                    </select>
                </div>
                <input type="hidden" th:field="*{empresa}" th:if="${empresas == null}" />
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="nome" class="form-label text-light">Nome</label>
                    <input type="text" class="form-control bg-dark text-light border-secondary" id="nome" th:field="*{nome}" required>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="email" class="form-label text-light">Email</label>
                    <input type="email" class="form-control bg-dark text-light border-secondary" id="email" th:field="*{email}" required>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="senha" class="form-label text-light">Senha</label>
                    <input type="password" class="form-control bg-dark text-light border-secondary" id="senha" th:field="*{senha}">
                    <small class="text-muted">Deixe em branco para manter a atual (na edição).</small>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="perfil" class="form-label text-light">Perfil</label>
                    <select class="form-select bg-dark text-light border-secondary" id="perfil" th:field="*{perfil}">
                        <option th:each="p : ${perfis}"
                                th:if="${isMaster} or ${p.name() != 'MASTER'}"
                                th:value="${p}" th:text="${p}"></option>
                    </select>
                </div>
            </div>

            <div class="d-flex gap-2 justify-content-end mt-4">
                <a th:href="@{/usuarios}" class="btn btn-secondary">Cancelar</a>
                <button type="submit" class="btn btn-primary">
                    <i class="fa-solid fa-save"></i> Salvar
                </button>
            </div>
        </form>
    </div>
</body>
</html>
