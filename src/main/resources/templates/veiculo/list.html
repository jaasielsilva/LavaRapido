<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::div})}">
<body>
    <div>
        <!-- Header Section -->
        <header class="mb-4 d-flex justify-content-between align-items-end">
            <div>
                <h1>Veículos</h1>
                <div class="subtitle">Gerencie a frota de veículos cadastrados</div>
            </div>
            <a th:href="@{/veiculos/novo}" class="btn btn-primary d-flex align-items-center gap-2 px-4">
                <i class="fa-solid fa-plus"></i> Novo Veículo
            </a>
        </header>

        <!-- Filter Bar (Clean Integration) -->
        <div class="mb-4">
            <form th:action="@{/veiculos}" method="get" class="filter-bar">
                <div class="filter-group flex-grow-1">
                    <label>Buscar</label>
                    <div class="search-input-wrapper">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="text" name="busca" th:value="${busca}" class="form-control-dark ps-5" placeholder="Buscar por placa, modelo ou cliente..." autocomplete="off">
                    </div>
                </div>

                <div class="filter-actions d-flex align-items-end gap-2">
                    <button type="submit" class="btn btn-primary btn-icon">
                        <i class="fa-solid fa-filter"></i>
                    </button>
                    <a th:href="@{/veiculos}" class="btn btn-outline-secondary btn-icon" title="Limpar Filtros">
                        <i class="fa-solid fa-eraser"></i>
                    </a>
                </div>
            </form>
        </div>

        <!-- List View (Floating Items) -->
        <div class="list-container">
            <!-- Empty State -->
            <div th:if="${veiculos.empty}" class="empty-state">
                <div class="icon-circle">
                    <i class="fa-solid fa-car-side"></i>
                </div>
                <h3>Nenhum veículo encontrado</h3>
                <p>Tente buscar com outros termos ou cadastre um novo veículo.</p>
            </div>

            <div th:each="veiculo : ${veiculos}" class="item-row">
                <!-- Year (Time slot in original) -->
                <div class="item-time">
                    <span class="time" th:text="${veiculo.ano != null ? veiculo.ano : '-'}">2020</span>
                    <span class="date">ANO</span>
                </div>

                <!-- Vehicle Info -->
                <div class="item-main">
                    <div class="vehicle-icon-wrapper">
                        <i class="fa-solid fa-car"></i>
                    </div>
                    <div class="info-content">
                        <div class="primary-text" th:text="${veiculo.modelo}">Modelo Veículo</div>
                        <div class="secondary-text d-flex gap-2 align-items-center">
                            <span class="plate-badge" th:text="${veiculo.placa}">ABC-1234</span>
                            <span class="text-secondary" style="font-size: 12px;">|</span>
                            <span class="text-secondary" style="font-size: 12px; font-weight: 500;" th:text="${veiculo.cor != null && !veiculo.cor.empty ? veiculo.cor : 'Sem cor'}">Prata</span>
                        </div>
                    </div>
                </div>

                <!-- Client (Status slot in original) -->
                <div class="item-status">
                     <div class="service-label">CLIENTE</div>
                     <div class="d-flex align-items-center mt-1">
                        <div class="avatar-initials me-2 bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center" 
                             style="width: 24px; height: 24px; font-size: 0.7rem;"
                             th:text="${#strings.substring(veiculo.cliente.nome, 0, 1)}">A</div>
                        <span class="text-white" style="font-size: 0.9rem;" th:text="${veiculo.cliente.nome}">Nome Cliente</span>
                     </div>
                </div>

                <!-- Actions -->
                <div class="item-end">
                    <div class="dropdown">
                        <button class="btn-action-trigger" type="button" data-bs-toggle="dropdown">
                            <i class="fa-solid fa-ellipsis"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end shadow-lg">
                            <li>
                                <a class="dropdown-item" th:href="@{/veiculos/editar/{id}(id=${veiculo.id})}">
                                    <i class="fa-solid fa-pen-to-square me-2"></i> Editar
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item text-danger" th:href="@{/veiculos/excluir/{id}(id=${veiculo.id})}"
                                   onclick="return confirm('Tem certeza que deseja excluir este veículo?');">
                                    <i class="fa-solid fa-trash me-2"></i> Excluir
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="mt-4 d-flex justify-content-center" th:if="${!veiculos.empty and veiculos.totalPages > 1}">
            <nav>
                <ul class="pagination pagination-dark">
                    <li class="page-item" th:classappend="${veiculos.first} ? ' disabled'">
                        <a class="page-link" th:href="@{/veiculos(page=${veiculos.number - 1},size=${veiculos.size},busca=${busca})}">
                            <i class="fa-solid fa-chevron-left"></i>
                        </a>
                    </li>
                    <li class="page-item disabled">
                        <span class="page-link" th:text="${veiculos.number + 1}">1</span>
                    </li>
                    <li class="page-item" th:classappend="${veiculos.last} ? ' disabled'">
                        <a class="page-link" th:href="@{/veiculos(page=${veiculos.number + 1},size=${veiculos.size},busca=${busca})}">
                            <i class="fa-solid fa-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <script th:inline="javascript">
        /*<![CDATA[*/
            document.addEventListener('DOMContentLoaded', function() {
                var veiculoSucesso = /*[[${veiculoSucesso}]]*/ null;
                var veiculoErro = /*[[${veiculoErro}]]*/ null;

                if (veiculoSucesso) {
                    let msg = veiculoSucesso === 'salvo' ? 'Veículo salvo com sucesso.' : 'Veículo excluído com sucesso.';
                    Swal.fire({
                        title: 'Sucesso!',
                        text: msg,
                        icon: 'success',
                        confirmButtonText: 'OK',
                        background: '#0f1623',
                        color: '#fff'
                    });
                }

                if (veiculoErro) {
                    Swal.fire({
                        title: 'Erro!',
                        text: veiculoErro,
                        icon: 'error',
                        confirmButtonText: 'OK',
                        background: '#0f1623',
                        color: '#fff'
                    });
                }
            });
        /*]]>*/
        </script>

        <style>
            /* Filter Bar Styles */
            .filter-bar {
                display: flex;
                gap: 20px;
                align-items: flex-end;
                flex-wrap: wrap;
                background: transparent;
            }
            
            .filter-group label {
                display: block;
                font-size: 12px;
                font-weight: 600;
                color: var(--text-secondary);
                margin-bottom: 8px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .form-control-dark {
                background-color: #0f1623;
                border: 1px solid #1e293b;
                color: white;
                padding: 10px 15px;
                border-radius: 10px;
                font-size: 14px;
                transition: all 0.2s;
                width: 100%;
            }
            
            .form-control-dark:focus {
                border-color: var(--primary-color);
                outline: none;
                box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
            }

            .search-input-wrapper {
                position: relative;
            }

            .search-input-wrapper i {
                position: absolute;
                left: 15px;
                top: 50%;
                transform: translateY(-50%);
                color: var(--text-secondary);
            }

            .btn-icon {
                width: 42px;
                height: 42px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 10px;
            }

            /* List Container Styles (copied from agendamento) */
            .list-container {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }

            .item-row {
                background-color: #0f1623;
                border: 1px solid #1e293b;
                border-radius: 12px;
                padding: 15px 20px;
                display: flex;
                align-items: center;
                gap: 20px;
                transition: transform 0.2s, box-shadow 0.2s;
            }

            .item-row:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
                border-color: #38bdf8;
            }

            .item-time {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 60px;
                padding-right: 20px;
                border-right: 1px solid #1e293b;
            }

            .item-time .time {
                font-size: 18px;
                font-weight: 700;
                color: white;
            }

            .item-time .date {
                font-size: 12px;
                color: var(--text-secondary);
                text-transform: uppercase;
            }

            .item-main {
                display: flex;
                align-items: center;
                gap: 15px;
                flex-grow: 1;
            }

            .vehicle-icon-wrapper {
                width: 40px;
                height: 40px;
                background-color: rgba(56, 189, 248, 0.1);
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--primary-color);
            }

            .info-content .primary-text {
                font-weight: 600;
                color: white;
                font-size: 16px;
            }

            .info-content .secondary-text {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 13px;
                color: var(--text-secondary);
                margin-top: 2px;
            }

            .plate-badge {
                background-color: #1e293b;
                color: var(--primary-color);
                padding: 2px 8px;
                border-radius: 4px;
                font-family: monospace;
                font-weight: 700;
                letter-spacing: 1px;
            }

            .item-services, .item-status {
                min-width: 150px;
            }

            .service-label {
                font-size: 10px;
                text-transform: uppercase;
                color: var(--text-secondary);
                font-weight: 700;
                margin-bottom: 4px;
            }

            .service-text {
                color: #e2e8f0;
                font-size: 14px;
            }

            .item-end {
                display: flex;
                align-items: center;
                gap: 20px;
                margin-left: auto;
            }

            .btn-action-trigger {
                background: transparent;
                border: none;
                color: var(--text-secondary);
                width: 32px;
                height: 32px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s;
            }

            .btn-action-trigger:hover, .dropdown.show .btn-action-trigger {
                background-color: #1e293b;
                color: white;
            }

            .empty-state {
                text-align: center;
                padding: 60px 20px;
                background-color: #0f1623;
                border-radius: 12px;
                border: 1px dashed #334155;
            }

            .icon-circle {
                width: 80px;
                height: 80px;
                background-color: rgba(15, 23, 42, 0.5);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 20px;
                color: #475569;
                font-size: 32px;
            }
        </style>
    </div>
</body>
</html>
